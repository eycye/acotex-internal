const CCLSMap = {
    '11': {
        '1': [-380, -250, -75, 160, 335, 510, 580, 590],
        '2': [-380, -250, -75, 160, 335, 510, 580, 590],
        '3': [-460, -280, -100, 140, 280, 465, 525, 530],
        '4': [-495, -300, -190, 70, 175, 340, 385, 385],
        '5': [-565, -450, -325, -140, 5, 85, 120, 120],
        '6': [-705, -550, -470, -355, -300, -255, -240, -240],
        '7': [-780, -645, -575, -470, -405, -360, -350, -350],
        '8': [-2000, -2000, -2000, -2000, -2000, -2000, -2000, -2000]
    },
    '21': {
        '1': [-380, -250, -75, 160, 335, 510, 580, 590],
        '2': [-380, -250, -75, 160, 335, 510, 580, 590],
        '3': [-460, -280, -100, 140, 280, 465, 525, 530],
        '4': [-495, -300, -190, 70, 175, 340, 385, 385],
        '5': [-565, -450, -325, -140, 5, 85, 120, 120],
        '6': [-705, -550, -470, -355, -300, -255, -240, -240],
        '7': [-780, -645, -575, -470, -405, -360, -350, -350],
        '8': [-2000, -2000, -2000, -2000, -2000, -2000, -2000, -2000]
    },
    '31': {
        '1': [-495, -280, -125, 95, 270, 455, 520, 525],
        '2': [-495, -280, -125, 95, 270, 455, 520, 525],
        '3': [-550, -295, -140, 90, 245, 425, 480, 485],
        '4': [-610, -335, -240, 60, 155, 280, 335, 335],
        '5': [-660, -490, -365, -185, -50, 10, 45, 45],
        '6': [-775, -585, -495, -375, -340, -305, -300, -300],
        '7': [-865, -680, -600, -480, -440, -410, -400, -400],
        '8': [-2000, -2000, -2000, -2000, -2000, -2000, -2000, -2000]
    },
    '41': {
        '1': [-660, -375, -240, 35, 115, 215, 235, 255],
        '2': [-660, -375, -240, 35, 115, 215, 235, 255],
        '3': [-660, -375, -240, 35, 115, 215, 235, 255],
        '4': [-705, -395, -315, 0, 55, 150, 170, 185],
        '5': [-800, -595, -495, -300, -180, -100, -85, -85],
        '6': [-895, -690, -605, -510, -445, -380, -380, -380],
        '7': [-1010, -795, -735, -630, -565, -525, -525, -525],
        '8': [-2000, -2000, -2000, -2000, -2000, -2000, -2000, -2000]
    },
    '51': {
       '1': [-835, -655, -495, -335, -265, -235, -230, -230],
       '2': [-835, -655, -495, -335, -265, -235, -230, -230],
       '3': [-835, -655, -495, -335, -265, -235, -230, -230],
       '4': [-835, -655, -495, -335, -265, -235, -230, -230],
       '5': [-855, -760, -685, -535, -465, -420, -415, -410],
       '6': [-1005, -855, -785, -655, -610, -555, -555, -555],
       '7': [-1105, -930, -885, -770, -730, -675, -675, -675],
       '8': [-2000, -2000, -2000, -2000, -2000, -2000, -2000, -2000]
    },
    '61': {
        '1': [-945, -800, -735, -545, -485, -445, -445, -445],
        '2': [-945, -800, -735, -545, -485, -445, -445, -445],
        '3': [-945, -800, -735, -545, -485, -445, -445, -445],
        '4': [-945, -800, -735, -545, -485, -445, -445, -445],
        '5': [-945, -800, -735, -545, -485, -445, -445, -445],
        '6': [-1095, -920, -880, -720, -670, -625, -625, -625],
        '7': [-1195, -1040, -980, -815, -760, -715, -715, -715],
        '8': [-2000, -2000, -2000, -2000, -2000, -2000, -2000, -2000]
    },
    '71': {
        '1': [-1145, -1090, -1030, -875, -835, -795, -795, -795],
        '2': [-1145, -1090, -1030, -875, -835, -795, -795, -795],
        '3': [-1145, -1090, -1030, -875, -835, -795, -795, -795],
        '4': [-1145, -1090, -1030, -875, -835, -795, -795, -795],
        '5': [-1145, -1090, -1030, -875, -835, -795, -795, -795],
        '6': [-1145, -1090, -1030, -875, -835, -795, -795, -795],
        '7': [-1230, -1125, -1075, -905, -885, -850, -850, -850],
        '8': [-2000, -2000, -2000, -2000, -2000, -2000, -2000, -2000]
    },
    '12': {
        '1': [-655, -345, -175, 55, 170, 300, 350, 360],
        '2': [-655, -345, -175, 55, 170, 300, 350, 360],
        '3': [-680, -360, -185, 50, 125, 260, 290, 300],
        '4': [-725, -370, -270, -30, 55, 205, 235, 240],
        '5': [-790, -585, -485, -260, -125, -45, -20, -20],
        '6': [-905, -700, -620, -470, -405, -345, -315, -315],
        '7': [-1025, -785, -730, -575, -530, -465, -440, -440],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '22': {
        '1': [-655, -345, -175, 55, 170, 300, 350, 360],
        '2': [-655, -345, -175, 55, 170, 300, 350, 360],
        '3': [-680, -360, -185, 50, 125, 260, 290, 300],
        '4': [-725, -370, -270, -30, 55, 205, 235, 240],
        '5': [-790, -585, -485, -260, -125, -45, -20, -20],
        '6': [-905, -700, -620, -470, -405, -345, -315, -315],
        '7': [-1025, -785, -730, -575, -530, -465, -440, -440],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '32': {
        '1': [-815, -470, -300, -90, 5, 45, 70, 80],
        '2': [-815, -470, -300, -90, 5, 45, 70, 80],
        '3': [-855, -490, -320, -115, -20, 20, 40, 40],
        '4': [-905, -545, -375, -200, -100, -55, -45, -45],
        '5': [-1020, -740, -600, -395, -325, -275, -260, -260],
        '6': [-1120, -810, -735, -560, -505, -475, -455, -455],
        '7': [-1240, -910, -835, -670, -610, -590, -570, -570],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '42': {
        '1': [-920, -635, -500, -275, -190, -150, -135, -135],
        '2': [-920, -635, -500, -275, -190, -150, -135, -135],
        '3': [-920, -635, -500, -275, -190, -150, -135, -135],
        '4': [-970, -670, -520, -315, -255, -215, -195, -195],
        '5': [-1090, -825, -695, -450, -370, -340, -320, -320],
        '6': [-1300, -905, -800, -615, -565, -535, -510, -510],
        '7': [-1350, -985, -905, -740, -675, -645, -625, -625],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '52': {
        '1': [-1140, -835, -725, -560, -500, -475, -455, -455],
        '2': [-1140, -835, -725, -560, -500, -475, -455, -455],
        '3': [-1140, -835, -725, -560, -500, -475, -455, -455],
        '4': [-1140, -835, -725, -560, -500, -475, -455, -455],
        '5': [-1215, -910, -840, -650, -595, -575, -555, -555],
        '6': [-1425, -1040, -975, -800, -755, -735, -715, -715],
        '7': [-1510, -1145, -1085, -910, -865, -835, -815, -815],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '62': {
        '1': [-1265, -1025, -950, -785, -750, -725, -710, -710],
        '2': [-1265, -1025, -950, -785, -750, -725, -710, -710],
        '3': [-1265, -1025, -950, -785, -750, -725, -710, -710],
        '4': [-1265, -1025, -950, -785, -750, -725, -710, -710],
        '5': [-1265, -1025, -950, -785, -750, -725, -710, -710],
        '6': [-1460, -1190, -1115, -935, -905, -880, -860, -860],
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '13': {
        '1': [-1110,-915,-845,-470,-380,-325,-255,-255],
        '2': [-1110,-915,-845,-470,-380,-325,-255,-255],
        '3': [-1150, -940, -870, -495, -405, -350, -280, -280],
        '4': [-1185, -1015, -935, -545, -455, -400, -330, -330],
        '5': [-1295, -1100, -1045, -670, -580, -510, -440, -440],
        '6': [-1405, -1175, -1110, -755, -665, -595, -525, -525],
        '7': [-1490, -1275, -1205, -835, -775, -705, -635, -635],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '23': {
        '1': [-1110,-915,-845,-470,-380,-325,-255,-255],
        '2': [-1110,-915,-845,-470,-380,-325,-255,-255],
        '3': [-1150, -940, -870, -495, -405, -350, -280, -280],
        '4': [-1185, -1015, -935, -545, -455, -400, -330, -330],
        '5': [-1295, -1100, -1045, -670, -580, -510, -440, -440],
        '6': [-1405, -1175, -1110, -755, -665, -595, -525, -525],
        '7': [-1490, -1275, -1205, -835, -775, -705, -635, -635],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '33': {
        '1': [-1215, -955, -855, -510, -445, -390, -325, -325],
        '2': [-1215, -955, -855, -510, -445, -390, -325, -325],
        '3': [-1215, -980, -895, -520, -455, -400, -325, -325],
        '4': [-1290, -1055, -975, -585, -520, -450, -375, -375],
        '5': [-1425, -1155, -1085, -725, -645, -565, -485, -485],
        '6': [-1485, -1230, -1190, -810, -760, -675, -595, -595],
        '7': [-1570, -1340, -1260, -935, -870, -785, -705, -705],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '43': {
        '1': [-1265, -995, -910, -630, -580, -545, -515, -515],
        '2': [-1265, -995, -910, -630, -580, -545, -515, -515],
        '3': [-1265, -995, -910, -630, -580, -545, -515, -515],
        '4': [-1340, -1070, -985, -675, -610, -570, -540, -540],
        '5': [-1450, -1170, -1095, -795, -745, -710, -680, -680],
        '6': [-1535, -1245, -1200, -875, -845, -810, -780, -780],
        '7': [-1625, -1355, -1270, -975, -945, -915, -885, -885],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '53': {
        '1': [-1420, -1110, -1010, -815, -775, -755, -725, -725],
        '2': [-1420, -1110, -1010, -815, -775, -755, -725, -725],
        '3': [-1420, -1110, -1010, -815, -775, -755, -725, -725],
        '4': [-1420, -1110, -1010, -815, -775, -755, -725, -725],
        '5': [-1505, -1190, -1120, -915, -895, -870, -840, -840],
        '6': [-1620, -1290, -1210, -1000, -980, -960, -930, -930],
        '7': [-1705, -1360, -1310, -1110, -1090, -1065, -1035, -1035],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '63': {
        '1': [-1635, -1275, -1200, -990, -955, -930, -900, -900],
        '2': [-1635, -1275, -1200, -990, -955, -930, -900, -900],
        '3': [-1635, -1275, -1200, -990, -955, -930, -900, -900],
        '4': [-1635, -1275, -1200, -990, -955, -930, -900, -900],
        '5': [-1635, -1275, -1200, -990, -955, -930, -900, -900],
        '6': [-1705, -1365, -1285, -1085, -1055, -1030, -1000, -1000],
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '24': {
        '1': [-1325, -1145, -1070, -675, -650, -590, -530, -530],
        '2': [-1325, -1145, -1070, -675, -650, -590, -530, -530],
        '3': [-1325, -1145, -1070, -675, -650, -590, -530, -530],
        '4': [-1450, -1270, -1170, -775, -750, -690, -630, -630],
        '5': [-1535, -1355, -1280, -900, -875, -815, -755, -755],
        '6': [-1695, -1515, -1440, -1090, -1065, -1005, -945, -945],
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '34': {
        '1': [-1340, -1160, -1085, -690, -665, -605, -545, -545],
        '2': [-1340, -1160, -1085, -690, -665, -605, -545, -545],
        '3': [-1340, -1160, -1085, -690, -665, -605, -545, -545],
        '4': [-1465, -1285, -1185, -790, -765, -705, -645, -645],
        '5': [-1550, -1370, -1295, -915, -890, -830, -770, -770],
        '6': [-1710, -1530, -1455, -1105, -1080, -1020, -960, -960],
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '44': {
        '1': [-1455, -1270, -1195, -805, -780, -720, -660, -660],
        '2': [-1455, -1270, -1195, -805, -780, -720, -660, -660],
        '3': [-1455, -1270, -1195, -805, -780, -720, -660, -660],
        '4': [-1530, -1370, -1245, -855, -830, -770, -710, -710],
        '5': [-1605, -1430, -1330, -955, -930, -870, -810, -810],
        '6': [-1765, -1580, -1505, -1160, -1135, -1075, -1015, -1015],
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '54': {
        '1': [-1555, -1395, -1320, -910, -895, -835, -785, -785],
        '2': [-1555, -1395, -1320, -910, -895, -835, -785, -785],
        '3': [-1555, -1395, -1320, -910, -895, -835, -785, -785],
        '4': [-1555, -1395, -1320, -910, -895, -835, -785, -785],
        '5': [-1640, -1465, -1365, -1025, -1000, -940, -890, -890],
        '6': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000], 
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '25': {
        '1': [-1585, -1400, -1325, -935, -910, -850, -790, -790],
        '2': [-1585, -1400, -1325, -935, -910, -850, -790, -790],
        '3': [-1585, -1400, -1325, -935, -910, -850, -790, -790],
        '4': [-1710, -1525, -1425, -1035, -1010, -950, -890, -890],
        '5': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '6': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000], 
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    },
    '35': {
        '1': [-1600, -1415, -1340, -950, -925, -865, -805, -805],
        '2': [-1600, -1415, -1340, -950, -925, -865, -805, -805],
        '3': [-1600, -1415, -1340, -950, -925, -865, -805, -805],
        '4': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '5': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '6': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000], 
        '7': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000],
        '8': [-4000, -4000, -4000, -4000, -4000, -4000, -4000, -4000]
    }
    // Add more data as needed
};

const extMap = {
    '0': 0,
    '01': -195,
    '02': -685,
    '11': -375,
    '12': -540,
    '71': -4000,
    '72': -4000,
    '*1': -480,
    '*2': -650
    // Add more data as needed
};

// Micronaire

var micMap = new TreeMap();

micMap.put(0,-1835);
micMap.put(25,-1360);
micMap.put(27,-925);
micMap.put(30,-625);
micMap.put(33,-460);
micMap.put(35,0);
micMap.put(37,10);
micMap.put(43,0);
micMap.put(50,-240);
micMap.put(53,-390);

// Fiber Strength
var strengthMap = new TreeMap();

strengthMap.put(0,-700);
strengthMap.put(18,-645);
strengthMap.put(19,-645);
strengthMap.put(20,-640);
strengthMap.put(21,-635);
strengthMap.put(22,-600);
strengthMap.put(23,-585);
strengthMap.put(24,-570);
strengthMap.put(25,-515);
strengthMap.put(26,0);
strengthMap.put(27,0);
strengthMap.put(28,0);
strengthMap.put(29,5);
strengthMap.put(30,20);
strengthMap.put(31,35);
strengthMap.put(33,50);

// [0.0, 18.0, 19.0 ... 31.0, 32.0, 33.0]
strengthList = [-700,-645,-645,-640,-635,-600,-585,-570,-515,0,0,0,5,20,35,35,50]

// Length Uniformity
var uniMap = new TreeMap();

uniMap.put(0,-110);
uniMap.put(78,-60);
uniMap.put(79,-50);
uniMap.put(80,0);
uniMap.put(81,0);
uniMap.put(82,5);
uniMap.put(83,10);
uniMap.put(84,15);
uniMap.put(85,20);
uniMap.put(86,25);

// [0.0, 78.0, 79.0 ... 86.0]
uniList = [-110,-60,-50,0,0,5,10,15,20,25]


function stringFloatRD(string) {
    return Math.floor(parseFloat(string));
}

function stplIndex(Stpl) {
    const stplInt = parseInt(Stpl, 10);
    return Math.min(Math.max(stplInt-31,0),7);
}

// Main Chart: Colors (Grade), Leaf, and Staple
function queryCCLS(C1, C2, Leaf, Stpl) {
    if (C1 === '8') {
        return -4000;
    }
    const color = C1+C2;
    if (color in CCLSMap && CCLSMap[color] && CCLSMap[color][Leaf] && Array.isArray(CCLSMap[color][Leaf])) {
        return CCLSMap[color][Leaf][stplIndex(Stpl)];
    }
    return null;
}

function queryExtraneous(Ext) {
    if (Ext in extMap) {
        return extMap[Ext];
    } else if (Ext.length > 1) {
        return extMap['*'+Ext[1]];
    }
    return null;
}

function queryMicronaire(Mic) {
    const micKey = stringFloatRD(Mic)
    return micMap.floorKey(micKey);
}

function queryStrength(Strength) {
    const strengthKey = stringFloatRD(Strength)
    return strengthMap.floorKey(strengthKey);
}

function queryUniform(Uni) {
    const uniKey = stringFloatRD(Uni)
    return uniMap.floorKey(uniKey);
}

function queryFinalDiscount(row) {
    // C1, C2, Leaf, Stpl, Mic, Ext, Strength, Uni
    // index: 7,8,9,10,12,13,14,19
    const [C1, C2, Leaf, Stpl, Mic, Ext, Strength, Uni] = [row[7],row[8],row[9],row[10],row[12],row[13],row[14],row[19]];
    console.log("args"+C1+C2+Leaf+Stpl+Mic+Ext+Strength+Uni);
    // Main Chart: Colors (Grade), Leaf, and Staple
    var finalDiscount = queryCCLS(C1, C2, Leaf, Stpl);
    if (finalDiscount===null) return null;  // Return null if data doesn't exist

    const extraneous = queryExtraneous(Ext);
    if (extraneous!==null) {finalDiscount+=extraneous;}

    const micronaire = queryMicronaire(Mic);
    if (micronaire!==null) {finalDiscount+=micronaire;}

    const strength = queryStrength(Strength);
    if (strength!==null) {finalDiscount+=strength;}

    const uniform = queryUniform(Uni);
    if (uniform!==null) {finalDiscount+=uniform;}
    console.log("lookhere"+finalDiscount);
    return finalDiscount;
}